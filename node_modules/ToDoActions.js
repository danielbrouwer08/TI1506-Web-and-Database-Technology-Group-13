"use strict"

var mysql = require('mysql')
var connection = mysql.createConnection({
	host: 'localhost',
	user: 'root',
	password: 'webdata',
	database: 'todo'
})

exports.connection = connection;

//Save all Todo's from client in a JSON file (NOT USED ANYMORE)
exports.save = function(server) {server.post("/save", function (req, res) {
	console.log("data has been posted");
	res.json({ "message": "You posted to the server" });
	console.log(req.body.list);
	ToDoArray = (req.body.list);
});}


//Send the last ID for a todoitem in the database
exports.lastId = function(server) { server.get("/lastid", function (req, res) {

	connection.query('Select max(todoitem.id) as maxid From todoitem WHERE todoitem.DueDate is not null and todoitem.CompletionDate is not null', function (error, results, fiels) {
		console.log("Sending following lastid to the client: " + results[0].maxid);
		res.json(results[0].maxid);
	});
});}


//Returns string representation of date object that client understands
exports.dateToString = function dateToString(date){
	
	var dd = date.getDate();
	var mm = date.getMonth() + 1;
	var yy = date.getFullYear();

	return (dd + "-" + mm + "-" + yy);
}
